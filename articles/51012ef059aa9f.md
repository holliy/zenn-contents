---
title: "WSL2ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰WSLgã‚’ä½¿ç”¨ã™ã‚‹"
emoji: "ğŸ“Ÿ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["WSL2", "WSL", "WSLg", "X11", "Wayland"]
published: true
---

WSL2ä¸Šã§Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰WSLgã‚’ä½¿ç”¨ã—ã¦GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

# ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ

WSLgã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚[^1]
|ã‚µãƒ¼ãƒ |ãƒã‚¦ãƒ³ãƒˆ|ç’°å¢ƒå¤‰æ•°|
|-------|--------|--------|
|X11    |`/tmp/.X11-unix`|`DISPLAY`                           |
|Wayland|`/mnt/wslg`     |`WAYLAND_DISPLAY`, `XDG_RUNTIME_DIR`|

::: message
systemd ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ç’°å¢ƒã§ã¯`$XDG_RUNTIME_DIR`ãŒ`/run/user/1000`ãªã©ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ãƒã‚¦ãƒ³ãƒˆã§ããªã„ã®ã§ã€ãã®å ´åˆã¯`export XDG_RUNTIME_DIR=/mnt/wslg/runtime-dir/`ã¨ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
:::

X11ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯XWaylandã§å‡¦ç†ã•ã‚Œã‚‹ã®ã§X11/Waylandã©ã¡ã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å‹•ä½œã—ã¾ã™ã€‚
![WSLgã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³](https://raw.githubusercontent.com/microsoft/wslg/839df800088e22069a053b717dad3689e263100e/docs/WSLg_ArchitectureOverview.png)
*WSLgã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³[^2]*

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯`ubuntu:22.04`ã¨ã—ã¾ã™ã€‚

```shell-session
$ docker run -it --name gui \
    --mount type=bind,source=/tmp/.X11-unix,target=/tmp/.X11-unix \
    --mount type=bind,source=/mnt/wslg,target=/mnt/wslg \
    --env DISPLAY=${DISPLAY} --env WAYLAND_DISPLAY=${WAYLAND_DISPLAY} \
    --env XDG_RUNTIME_DIR=${XDG_RUNTIME_DIR} \
    ubuntu:22.04
```

::: message alert
`/mnt/wslg/distro`ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨Dockerãƒ›ã‚¹ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
å¾Œè¿°ã®ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã«ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã®æ¨©é™ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

# å‹•ä½œç¢ºèª

## X11 ã®å‹•ä½œç¢ºèª

```shell-session:ã‚³ãƒ³ãƒ†ãƒŠå†…
# apt install x11-apps
# xeyes
```

## Wayland ã®å‹•ä½œç¢ºèª

```shell-session:ã‚³ãƒ³ãƒ†ãƒŠå†…
# apt install weston
# weston-simple-egl
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚(weston-simple-egl ã¯ä¸‰è§’å½¢ãŒå›è»¢ã—ã¦ã¾ã™)

![å‹•ä½œç¢ºèª](/images/51012ef059aa9f/1.png)

# ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®ãƒ•ã‚©ãƒ³ãƒˆã¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰å‚ç…§ã•ã‚Œã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®ã¿æ–‡å­—åŒ–ã‘ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

![ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼æ–‡å­—åŒ–ã‘](/images/51012ef059aa9f/2.png)
*gnome-terminal
ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã«ã€Œã‚ã„ã†ãˆãŠã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã»ã—ã„*

ãƒ•ã‚©ãƒ³ãƒˆã¯`/mnt/wslg/distro`é…ä¸‹ã®`/usr/share/fonts`ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚[^3]
`/mnt/wslg/distro`ã¯Dockerãƒ›ã‚¹ãƒˆã®`/`ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã‚‹ã®ã§Dockerãƒ›ã‚¹ãƒˆå´ã§ãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shell-session:Dockerãƒ›ã‚¹ãƒˆå´
$ sudo apt install fonts-noto-cjk
```

ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ãŸã‚ã«ä¸€åº¦WSLã‚’çµ‚äº†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shell-session:ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
> wsl --shutdown
```

![ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šå¾Œ](/images/51012ef059aa9f/3.png)
*ãƒ›ã‚¹ãƒˆå´ã®ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šå¾Œ*

[^1]: https://github.com/microsoft/wslg/blob/main/samples/container/Containers.md
[^2]: https://github.com/microsoft/wslg#wslg-architecture-overview
[^3]: [WSLgã®fontconfig](https://github.com/microsoft/wslg/blob/df4a42270d539b75b45ed5ea8706d35db9287186/config/local.conf)

